%% Code for Processing Cyclic Voltammetry Data
% Gives graphs of voltage vs. current for all cycles
% All graphs should save automatically into the folder specific by variable
% savelocation.
% Code prepared by Leo W. Gordon

clc;
close all;
clear all;

valuestr = inputdlg({'Enter Filepath','Enter Scan Rate (µV/s)'},'Input Values'); 
% enter full filepath in the dialogue box, or have the file in the same directory as the code file and use only file name
filename = string(valuestr(1,:));
rate = str2double(valuestr(2,:));

a = readtable(filename);
M = table2array(a);

area = pi*0.3^2;

cn = M(:,11);
num_cycles = max(cn);
n = num_cycles;

for i=(1:1:n)
    a1 = M(cn==i,:);
    V = a1(:,9);
    I = a1(:,10)/area;
    
    num = ['Cycle ', num2str(i)];
    
    plot(V,I,'linewidth',3,'DisplayName', num)
    hold on
end
hold off
%title(strcat('Cyclic Voltammograms at', '{ }', rate, '{ }','µV s^{-1}'),'fontsize',18)
xlabel('Voltage (V)','fontsize',20,'FontWeight','bold')
ylabel('Current Density (mA cm^{-2})','fontsize',20,'FontWeight','bold')
legend show
legend('fontsize',16,'location','northwest')
legend box 'off'
%grid on
%grid minor
box on
ax = gca;
size = ax.FontSize;
ax.FontSize = 18;
weight = ax.FontWeight;
ax.FontWeight = 'bold';
ax.LineWidth = 2;

shortfilename = erase(filename,'.txt'); % remove .txt from the filename
name = strcat(shortfilename,'_CV.pdf');
savelocation = '/Users/lgordon/Documents/All Figures/'; % change to desired save location

orient(figure(1),'landscape')
print('-f1',name,'-dpdf','-bestfit')
    movefile(name,savelocation);
